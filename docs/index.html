<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Pedestrian Frequency Data from the Hystreet Project • hystReet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Get Pedestrian Frequency Data from the Hystreet Project">
<meta property="og:description" content="An R API wrapper for the Hystreet project &lt;https://hystreet.com&gt;. Hystreet provides pedestrian counts in different cities in Germany.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hystReet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Getting_started_with_the_R_package_hystReet.html">Getting started with the R-package hystReet</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JohannesFriedrich/hystReet/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="hystreet" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#hystreet" class="anchor"></a>hystReet</h1></div>
<!-- badges: start -->

<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><a href="https://hystreet.com">hystreet</a> is a company that collects data on pedestrian traffic in shopping streets of different German cities. After registering you can access and download the data via their website.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The package is now on CRAN. The easiest way to download is via:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"hystReet"</span><span class="op">)</span></code></pre></div>
<p>You can install the development version from GitHub with the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/">"devtools"</a></span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"JohannesFriedrich/hystReet"</span><span class="op">)</span></code></pre></div>
</div>
<div id="api-keys" class="section level2">
<h2 class="hasAnchor">
<a href="#api-keys" class="anchor"></a>API Keys</h2>
<p>To use this package, you will first need to get a hystreet API key. To do so, you first need to set up an account on <a href="https://hystreet.com/" class="uri">https://hystreet.com/</a>. After that you can request an API key via <a href="mailto:info@hystreet.com">e-mail</a>. Once your request has been granted, you will find you key in your hystreet account profile.</p>
<p>Now you have three options:</p>
<ol>
<li>Once you have your key, you can save it as an environment variable for the current session by running the following command:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>HYSTREET_API_TOKEN <span class="op">=</span> <span class="st">"PASTE YOUR API TOKEN HERE"</span><span class="op">)</span></code></pre></div>
<ol>
<li>Alternatively, you can set it permanently with the help of <code><a href="https://usethis.r-lib.org/reference/edit.html">usethis::edit_r_environ()</a></code> by adding the following line to your <code>.Renviron</code>:</li>
</ol>
<!-- --><div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>HYSTREET_API_TOKEN <span class="ot">=</span> PASTE YOUR API TOKEN HERE</span></code></pre></div>
<ol>
<li>If you don’t want to save your API token here, you can enter it for each function of this package using the <code>API_token</code> parameter.</li>
</ol>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<table class="table">
<colgroup>
<col width="25%">
<col width="47%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Function name</th>
<th>Description</th>
<th>Example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>get_hystreet_stats()</td>
<td>request common statistics about the hystreet project</td>
<td>get_hystreet_stats()</td>
</tr>
<tr class="even">
<td>get_hystreet_locations()</td>
<td>request all available locations</td>
<td>get_hystreet_locations()</td>
</tr>
<tr class="odd">
<td>get_hystreet_station_data()</td>
<td>request data from a stations</td>
<td>get_hystreet_station_data(71)</td>
</tr>
<tr class="even">
<td>set_hystreet_token()</td>
<td>set your API token</td>
<td>set_hystreet_token(123456789)</td>
</tr>
</tbody>
</table>
<div id="load-some-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#load-some-statistics" class="anchor"></a>Load some statistics</h3>
<p>The function <code><a href="reference/get_hystreet_stats.html">get_hystreet_stats()</a></code> summarises the number of available stations and the sum of all counted pedestrians.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JohannesFriedrich/hystReet">hystReet</a></span><span class="op">)</span>
<span class="co">## Loading required package: httr</span>
<span class="co">## Loading required package: jsonlite</span>
<span class="co">## </span>
<span class="co">## Attaching package: 'jsonlite'</span>
<span class="co">## The following object is masked from 'package:purrr':</span>
<span class="co">## </span>
<span class="co">##     flatten</span>

<span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_stats.html">get_hystreet_stats</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stats</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
stations
</th>
<th style="text-align:right;">
today_count
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
154
</td>
<td style="text-align:right;">
38869
</td>
</tr></tbody>
</table>
</div>
<div id="request-all-stations" class="section level3">
<h3 class="hasAnchor">
<a href="#request-all-stations" class="anchor"></a>Request all stations</h3>
<p>The function <code><a href="reference/get_hystreet_locations.html">get_hystreet_locations()</a></code> generates a data frame with all available stations of the project.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_locations.html">get_hystreet_locations</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">locations</span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
city
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
85
</td>
<td style="text-align:left;">
Am Brand
</td>
<td style="text-align:left;">
Mainz
</td>
</tr>
<tr>
<td style="text-align:right;">
127
</td>
<td style="text-align:left;">
Poststraße
</td>
<td style="text-align:left;">
Braunschweig
</td>
</tr>
<tr>
<td style="text-align:right;">
300
</td>
<td style="text-align:left;">
Grimmaische Straße
</td>
<td style="text-align:left;">
Leipzig
</td>
</tr>
<tr>
<td style="text-align:right;">
306
</td>
<td style="text-align:left;">
Mariahilfer Straße (Mitte)
</td>
<td style="text-align:left;">
Wien
</td>
</tr>
<tr>
<td style="text-align:right;">
88
</td>
<td style="text-align:left;">
Breite Gasse
</td>
<td style="text-align:left;">
Nürnberg
</td>
</tr>
<tr>
<td style="text-align:right;">
256
</td>
<td style="text-align:left;">
Kirchgasse (Nord)
</td>
<td style="text-align:left;">
Wiesbaden
</td>
</tr>
<tr>
<td style="text-align:right;">
311
</td>
<td style="text-align:left;">
Platzgasse (Süd)
</td>
<td style="text-align:left;">
Ulm
</td>
</tr>
<tr>
<td style="text-align:right;">
255
</td>
<td style="text-align:left;">
Simeonstraße
</td>
<td style="text-align:left;">
Trier
</td>
</tr>
<tr>
<td style="text-align:right;">
64
</td>
<td style="text-align:left;">
Große Packhofstraße
</td>
<td style="text-align:left;">
Hannover
</td>
</tr>
<tr>
<td style="text-align:right;">
108
</td>
<td style="text-align:left;">
Große Straße (Mitte)
</td>
<td style="text-align:left;">
Osnabrück
</td>
</tr>
</tbody>
</table>
</div>
<div id="request-data-from-a-specific-station" class="section level3">
<h3 class="hasAnchor">
<a href="#request-data-from-a-specific-station" class="anchor"></a>Request data from a specific station</h3>
<p>The (probably) most interesting function is <code><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data()</a></code>. Using the hystreetID it is possible to request a specific station. By default, all the data from the current day are received. With the <code>query</code> argument it is possible to define the time and sampling frame of the data more precisely: <code>from</code>: datetime of earliest measurement (default: today 00:00:00:): e.g. “2018-10-01 12:00:00” or “2018-10-01” <code>to</code> : datetime of latest measurement (default: today 23:59:59): e.g. “2018-12-01 12:00:00” or “2018-12-01” <code>resoution</code>: Resolution for the measurement (default: hour): “day”, “hour”, “month”, “week”</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
  hystreetId <span class="op">=</span> <span class="fl">71</span>,
  query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2018-12-01"</span>, to <span class="op">=</span> <span class="st">"2018-12-31"</span>, resolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="some-ideas-for-visualising-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#some-ideas-for-visualising-the-data" class="anchor"></a>Some ideas for visualising the data</h2>
<p>Let´s see if we can find the busiest days in December 2018. Saturdays were probably quite busy, while there should have been substantially less pedestrian traffic on the 24th and 25th of December, both of which are holidays in Germany.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
    hystreetId <span class="op">=</span> <span class="fl">71</span>, 
    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2018-12-01"</span>, to <span class="op">=</span> <span class="st">"2019-01-01"</span>, resolution <span class="op">=</span> <span class="st">"hour"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">measurements</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">timestamp</span>, y <span class="op">=</span> <span class="va">pedestrians_count</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">weekdays</a></span><span class="op">(</span><span class="va">timestamp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_path</span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"7 days"</span>, labels <span class="op">=</span> <span class="fu">date_format</span><span class="op">(</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>,
       y <span class="op">=</span> <span class="st">"Pedestrians"</span>,
       colour <span class="op">=</span> <span class="st">"Day"</span><span class="op">)</span></code></pre></div>
<p><img src="README_figs/README-station_71-1.png" width="672" style="display: block; margin: auto;"></p>
<div id="compare-different-stations" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-different-stations" class="anchor"></a>Compare different stations</h3>
<p>Now let´s compare data from different stations:</p>
<ol>
<li>Load the data</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_73</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
    hystreetId <span class="op">=</span> <span class="fl">73</span>, 
    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2019-01-01"</span>, to <span class="op">=</span> <span class="st">"2019-01-31"</span>, resolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">measurements</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">pedestrians_count</span>, <span class="va">timestamp</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>station <span class="op">=</span> <span class="fl">73</span><span class="op">)</span>

<span class="va">data_74</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
    hystreetId <span class="op">=</span> <span class="fl">74</span>, 
    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2019-01-01"</span>, to <span class="op">=</span> <span class="st">"2019-01-31"</span>, resolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">measurements</span> <span class="op">%&gt;%</span> 
    <span class="fu">select</span><span class="op">(</span><span class="va">pedestrians_count</span>, <span class="va">timestamp</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>station <span class="op">=</span> <span class="fl">74</span><span class="op">)</span>

<span class="va">data_73_74</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data_73</span>, <span class="va">data_74</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">data_73_74</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">timestamp</span>, y <span class="op">=</span> <span class="va">pedestrians_count</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">weekdays</a></span><span class="op">(</span><span class="va">timestamp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_datetime</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">date_format</span><span class="op">(</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">station</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="README_figs/README-station_73_74-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="highest-ratio-pedestriansday" class="section level3">
<h3 class="hasAnchor">
<a href="#highest-ratio-pedestriansday" class="anchor"></a>Highest ratio (pedestrians/day)</h3>
<p>Now a little bit of big data analysis. Let´s find the station with the highest pedestrians per day ratio:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hystreet_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_locations.html">get_hystreet_locations</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">hystreet_ids</span><span class="op">[</span>,<span class="st">"id"</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
    hystreetId <span class="op">=</span> <span class="va">ID</span>,
    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2019-01-01"</span>, to <span class="op">=</span> <span class="st">"2019-12-31"</span>, resolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span>
  
  
    <span class="va">lifetime_count</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">statistics</span><span class="op">$</span><span class="va">timerange_count</span>
    <span class="va">days_counted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">latest_measurement_at</span>  <span class="op">-</span> <span class="va">temp</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">earliest_measurement_at</span><span class="op">)</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="va">ID</span>,
      station <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">city</span>, <span class="st">" ("</span>,<span class="va">temp</span><span class="op">$</span><span class="va">name</span>,<span class="st">")"</span><span class="op">)</span>,
      ratio <span class="op">=</span> <span class="va">lifetime_count</span><span class="op">/</span><span class="va">days_counted</span><span class="op">)</span><span class="op">)</span>
  
<span class="op">}</span><span class="op">)</span>

<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">all_data</span><span class="op">)</span></code></pre></div>
<p>Which stations have the highest ratio?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ratio</span> <span class="op">%&gt;%</span> 
  <span class="fu">top_n</span><span class="op">(</span><span class="fl">5</span>, <span class="va">ratio</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span><span class="op">)</span>
<span class="co">##    id                      station    ratio</span>
<span class="co">## 1  73   München (Neuhauser Straße) 26466.29</span>
<span class="co">## 2  63       Hannover (Georgstraße) 19491.42</span>
<span class="co">## 3  47  Köln (Schildergasse (West)) 18873.99</span>
<span class="co">## 4 165    München (Kaufingerstraße) 16631.00</span>
<span class="co">## 5 159 Köln (Schildergasse (Mitte)) 15688.65</span></code></pre></div>
<p>Now let´s visualise the top 10 locations:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">ratio</span> <span class="op">%&gt;%</span> 
         <span class="fu">top_n</span><span class="op">(</span><span class="fl">10</span>,<span class="va">ratio</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">station</span>, <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Location"</span>,
       y <span class="op">=</span> <span class="st">"Pedestrians per day"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="README_figs/README-ratio_plot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="corona-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#corona-effects" class="anchor"></a>Corona effects</h3>
<p>The Hystreet-API is a great source of analysing the social effects of the Corona pandemic in 2020. Let´s collect all german stations since March 2020 and analyse the pedestrian count until 10th June 2020.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">hystreet_ids</span><span class="op">[</span>,<span class="st">"id"</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">{</span>

    <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_hystreet_station_data.html">get_hystreet_station_data</a></span><span class="op">(</span>
        hystreetId <span class="op">=</span> <span class="va">ID</span>,
        query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"2020-03-01"</span>, to <span class="op">=</span> <span class="st">"2020-06-10"</span>, resolution <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
    <span class="op">)</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">name</span>,
    city <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">city</span>,
    timestamp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">measurements</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,
    pedestrians_count <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">measurements</span><span class="op">$</span><span class="va">pedestrians_count</span>,
    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">city</span>, <span class="va">temp</span><span class="op">$</span><span class="va">name</span>, sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
   
<span class="op">}</span><span class="op">)</span> 

<span class="va">data_all</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_all</span> <span class="op">%&gt;%</span> 
<span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">timestamp</span><span class="op">)</span>, <span class="va">pedestrians_count</span>, colour <span class="op">=</span> <span class="va">legend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">geom_line</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_date</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">date_format</span><span class="op">(</span><span class="st">"%d.%m.%Y"</span><span class="op">)</span>,
               breaks <span class="op">=</span> <span class="fu">date_breaks</span><span class="op">(</span><span class="st">"7 days"</span><span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span><span class="st">"Legende"</span><span class="op">)</span>,
         axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>,
       y <span class="op">=</span> <span class="st">"Persons/Day"</span><span class="op">)</span></code></pre></div>
<p><img src="README_figs/README-corona_effects_plot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=hystReet">https://​cloud.r-project.org/​package=hystReet</a>
</li>
<li>Browse source code at <br><a href="https://github.com/JohannesFriedrich/hystReet/">https://​github.com/​JohannesFriedrich/​hystReet/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/JohannesFriedrich/hystReet/issues">https://​github.com/​JohannesFriedrich/​hystReet/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Johannes Friedrich <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=hystReet"><img src="http://www.r-pkg.org/badges/version/hystReet" alt="CRAN"></a></li>
<li><a href="https://www.r-pkg.org/pkg/hystReet"><img src="https://cranlogs.r-pkg.org/badges/grand-total/hystReet" alt="Downloads"></a></li>
<li><a href="https://travis-ci.org/JohannesFriedrich/hystReet"><img src="https://travis-ci.org/JohannesFriedrich/hystReet.svg?branch=master" alt="Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/JohannesFriedrich/hystreet"><img src="https://ci.appveyor.com/api/projects/status/hfno1wngf2yqs4e9?svg=true" alt="Build status"></a></li>
<li><a href="https://github.com/JohannesFriedrich/hystReet/actions"><img src="https://github.com/JohannesFriedrich/hystReet/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Johannes Friedrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
